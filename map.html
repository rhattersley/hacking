<!DOCTYPE html>
<html>
<head>
  <title>Leafletjs - Ordnance Survey OpenSpace Example</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
</head>
<body>

  <h2>Leafletjs - Ordnance Survey OpenSpace Example</h2>
  <p>See <a href="https://github.com/rob-murray/os-leaflet" title="A leaflet TileLayer using Ordnance Survey OpenSpace web map service">github.com/os-leaflet</a> project for more details.</p>

<div id="label">@???</div>
  <div id="map" style="width: 600px; height: 475px; border: 1px solid black;"></div>


  <!-- dependencies -->
  <!--
    We're tied to specific versions of Proj4Leaflet and its dependency on Proj4js

    ** Don't pull files from github like this in production apps!
  -->
  <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
  <script src="https://rawgithub.com/kartena/Proj4Leaflet/master/lib/proj4-compressed.js"></script><!-- proj4js -->
  <script src="https://rawgithub.com/kartena/Proj4Leaflet/master/src/proj4leaflet.js"></script><!-- proj4leaflet -->
  <script src="https://rawgithub.com/rob-murray/os-leaflet/master/OSOpenSpace.js"></script><!-- OS OpenSpace layer -->


  <script>

(function() {
    "use strict";

    var map,
      OSHQ = {
        WGS84: [50.936715, -1.4701989],
        OSGB: [437324, 115386]
      };

    function init() {
      var popup = L.popup(),
        openspaceLayer;

      /* L.Map with OS options */
      var osgb = L.OSOpenSpace.getCRS();
      map = new L.Map('map', {
        crs: osgb,
        continuousWorld: true,
        worldCopyJump: false,
        minZoom: 0,
        maxZoom: L.OSOpenSpace.RESOLUTIONS.length - 1,
      });

      /* New L.TileLayer.OSOpenSpace with API Key */
      openspaceLayer = L.tileLayer.OSOpenSpace("EC9EDE7DAD732ABAE0430C6CA40AB812", {debug: true});

      map.addLayer(openspaceLayer);
      map.setView(OSHQ.WGS84, 1);

      /* add some ui elems to the map */
      L.control.scale().addTo(map);

    function updateBounds(latlng) {
        // XXX Using a (WGS84?) rectangle might introduce distortions.
        var half_width = 200000;
        var half_height = 120000;
        var xy = osgb.project(latlng);
        xy = osgb.projection.project(latlng);
        var bottom_left_xy = [xy.x - half_width, xy.y - half_height];
        var top_right_xy = [xy.x + half_width, xy.y + half_height];
        var bottom_left_ll = osgb.projection.unproject(bottom_left_xy);
        var top_right_ll = osgb.projection.unproject(top_right_xy);
        box.setBounds([bottom_left, top_right_ll]);
    };

      var box = L.rectangle([[50, -3], [52, -1]]);
      box.addTo(map);

      map.on('move', function(e) {
        label = L.DomUtil.get('label');
        label.innerHTML = "@" + osgb.project(map.getCenter());
        updateBounds(map.getCenter());
      });
  }

  window.onload = init;
} ());

  </script>

</body>
</html>
